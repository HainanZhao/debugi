<div class="container">
  <h2 class="title">JSON Query</h2>
  <p class="description">
    Query JSON data using SQL-like syntax. Enter your JSON data and SQL query below.
  </p>
  
  <!-- Input Section -->
  <div class="section" id="json-input" [class.highlighted]="highlightedSection === 'json-input'">
    <h3>JSON Data</h3>
    <div class="actions">
      <button (click)="loadSampleData()" class="sample-btn sample-btn-small">Load Sample Data</button>
      <button (click)="prettifyJson()" class="prettify-btn" title="Formats JSON and attempts to fix common syntax errors">Format JSON</button>
      <button (click)="clearData()" class="clear-btn">Clear</button>
    </div>
    <div class="textarea-container">
      <textarea 
        [(ngModel)]="jsonInput" 
        placeholder="Paste your JSON data here..."
        rows="10"
        class="json-input"
      ></textarea>
      <div *ngIf="jsonFormatError" class="error-message">
        <strong>Error:</strong> {{jsonFormatError}}
      </div>
      <div *ngIf="!jsonFormatError" class="format-hint">
        <small>Format JSON can fix common issues like single quotes and missing quotes around property names.</small>
      </div>
    </div>
  </div>
  
  <!-- Query Section -->
  <div class="section" id="sql-query" [class.highlighted]="highlightedSection === 'sql-query'">
    <h3>SQL Query</h3>
    <p class="query-help">
      Use SQL syntax to query the JSON data. The data is referenced using '?' as a placeholder.
    </p>
    <div class="sample-queries">
      <span>Sample queries:</span>
      <div class="query-chips">
        <button 
          *ngFor="let query of sampleSqlQueries" 
          (click)="loadSampleQuery(query)" 
          class="query-chip"
        >
          {{query}}
        </button>
      </div>
    </div>
    <div class="textarea-container">
      <textarea 
        [(ngModel)]="sqlQuery" 
        placeholder="Enter your SQL query here... (e.g., SELECT * FROM ? WHERE age > 25)"
        rows="4"
        class="sql-input"
      ></textarea>
    </div>
    <button 
      (click)="executeQuery()" 
      class="execute-btn"
      [disabled]="!jsonInput || !sqlQuery || isLoading"
    >
      <span *ngIf="!isLoading">Execute Query</span>
      <span *ngIf="isLoading">Executing...</span>
    </button>
  </div>
  
  <!-- Results Section -->
  <div class="section" id="query-results" *ngIf="queryResult.data.length > 0 || queryResult.error" [class.highlighted]="highlightedSection === 'query-results'">
    <h3>Query Results</h3>
    <div class="result-options">
      <div class="format-options">
        <span>Display format:</span>
        <label>
          <input type="radio" [(ngModel)]="resultFormat" value="table"> Table
        </label>
        <label>
          <input type="radio" [(ngModel)]="resultFormat" value="json"> JSON
        </label>
      </div>
      <button (click)="copyResults()" class="copy-btn">Copy Results</button>
    </div>
    
    <div *ngIf="queryResult.executionTime" class="execution-info">
      Query executed in {{queryResult.executionTime}}ms, returned {{queryResult.data.length}} records
    </div>
    
    <!-- Error Message -->
    <div *ngIf="queryResult.error" class="error-message">
      <strong>Error:</strong> {{queryResult.error}}
    </div>
    
    <!-- Table Results -->
    <div *ngIf="resultFormat === 'table' && queryResult.data.length > 0" class="table-results">
      <table>
        <thead>
          <tr>
            <th *ngIf="showLineNumbers">#</th>
            <th *ngFor="let column of getColumnNames()">{{column}}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of queryResult.data; let i = index">
            <td *ngIf="showLineNumbers">{{i + 1}}</td>
            <td *ngFor="let column of getColumnNames()">
              {{row[column] !== null && row[column] !== undefined ? row[column] : ''}}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- JSON Results -->
    <div *ngIf="resultFormat === 'json' && queryResult.data.length > 0" class="json-results">
      <pre>{{formatJsonOutput()}}</pre>
    </div>
  </div>
  
  <!-- Help Section -->
  <div class="section" id="query-help" [class.highlighted]="highlightedSection === 'query-help'">
    <h3>SQL Query Guide</h3>
    <div class="help-content">
      <div class="help-section">
        <h4>Basic Query Syntax</h4>
        <pre>SELECT column1, column2 FROM ? WHERE condition</pre>
        <p>Use '?' as a placeholder for your JSON data</p>
      </div>
      
      <div class="help-section">
        <h4>Common Operations</h4>
        <ul>
          <li><strong>SELECT:</strong> SELECT column1, column2, ... (or * for all columns)</li>
          <li><strong>WHERE:</strong> WHERE age > 25 AND gender = 'male'</li>
          <li><strong>ORDER BY:</strong> ORDER BY column [ASC|DESC]</li>
          <li><strong>GROUP BY:</strong> GROUP BY column</li>
          <li><strong>LIMIT:</strong> LIMIT 10</li>
          <li><strong>Aggregations:</strong> COUNT(*), SUM(column), AVG(column), MIN(column), MAX(column)</li>
        </ul>
      </div>
      
      <div class="help-section">
        <h4>Examples</h4>
        <ul>
          <li>Select all records: <code>SELECT * FROM ?</code></li>
          <li>Filter by condition: <code>SELECT * FROM ? WHERE age > 30</code></li>
          <li>Multiple conditions: <code>SELECT name, age FROM ? WHERE age > 25 AND gender = 'male'</code></li>
          <li>Sorting results: <code>SELECT * FROM ? ORDER BY age DESC</code></li>
          <li>Grouping: <code>SELECT gender, COUNT(*) as count FROM ? GROUP BY gender</code></li>
          <li>Limit results: <code>SELECT * FROM ? LIMIT 5</code></li>
        </ul>
      </div>
    </div>
  </div>
</div>
