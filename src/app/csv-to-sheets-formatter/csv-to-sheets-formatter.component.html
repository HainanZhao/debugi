<div class="container">
  <h2 class="title">CSV Utilities</h2>

  <!-- Configuration Section - One Line -->
  <section class="section" id="csv-conversion">
    <h3>Configuration</h3>
    <div class="config-group">
      <div class="config-item">
        <label for="delimiter">Delimiter:</label>
        <select id="delimiter" [(ngModel)]="delimiter" (change)="formatForSheets()">
          <option value=",">Comma (,)</option>
          <option value=";">Semicolon (;)</option>
          <option value="\t">Tab</option>
          <option value="|">Pipe (|)</option>
        </select>
      </div>
      
      <div class="config-item">
        <label><input type="checkbox" [(ngModel)]="hasHeaders" (change)="analyzeCSV()"> Has Headers</label>
      </div>
      
      <button class="sample-btn" (click)="loadSampleData()">Load Sample Data</button>
    </div>
  </section>

  <!-- Input Section -->
  <section class="section" id="csv-input">
    <h3>CSV Input</h3>
    <label for="csvInput">Paste CSV Data:</label>
    <textarea 
      id="csvInput" 
      [(ngModel)]="csvInput" 
      rows="6" 
      placeholder="e.g., Name,Age,City,Email&#10;John Doe,30,New York,john@example.com&#10;Jane Smith,25,Los Angeles,jane@example.com"
      (input)="analyzeCSV()"
    ></textarea>
    
    <button (click)="formatForSheets()">Convert</button>
    <button (click)="analyzeCSV()">Analyze</button>
    <button (click)="clearData()">Clear</button>
  </section>

  <!-- Data Manipulation Section - Compact 2-Row Layout -->
  <section class="section" id="csv-manipulation" *ngIf="csvStats">
    <h3>Data Manipulation</h3>
    
    <!-- Row 1: Sort and Filter Controls -->
    <div class="manipulation-row">
      <div class="control-group-inline">
        <h4>Sort:</h4>
        <select [(ngModel)]="sortColumn">
          <option value="-1">Select column...</option>
          <option *ngFor="let header of csvStats.headers; let i = index" [value]="i">
            {{ header }}
          </option>
        </select>
        <select [(ngModel)]="sortDirection">
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>
        <button (click)="sortData()" [disabled]="sortColumn === -1">Sort</button>
      </div>
      
      <div class="control-group-inline">
        <h4>Filter:</h4>
        <select [(ngModel)]="filterColumn">
          <option value="-1">Select column...</option>
          <option *ngFor="let header of csvStats.headers; let i = index" [value]="i">
            {{ header }}
          </option>
        </select>
        <input 
          type="text" 
          [(ngModel)]="filterValue" 
          placeholder="Filter value..."
          (input)="filterData()"
        >
        <button (click)="filterData()" [disabled]="filterColumn === -1 || !filterValue">Filter</button>
      </div>
    </div>
    
    <!-- Row 2: Data Operations -->
    <div class="manipulation-row">
      <div class="control-group-inline">
        <h4>Operations:</h4>
        <button (click)="removeDuplicates()">Remove Duplicates</button>
        <button (click)="transoposeData()">Transpose</button>
      </div>
    </div>
  </section>

  <!-- Output Section -->
  <section class="section" id="csv-output" *ngIf="csvOutput">
    <h3>Output</h3>
    
    <div class="output-controls">
      <div class="config-item">
        <label for="outputFormat">Output Format:</label>
        <select id="outputFormat" [(ngModel)]="outputFormat" (change)="formatForSheets()">
          <option value="tabs">Tab-separated (Google Sheets)</option>
          <option value="json">JSON</option>
          <option value="sql">SQL</option>
          <option value="html">HTML Table</option>
          <option value="xml">XML</option>
          <option value="markdown">Markdown</option>
        </select>
      </div>
      
      <div class="action-buttons">
        <button class="copy-btn" (click)="copyToClipboard(csvOutput)">ðŸ“‹ Copy</button>
        <button class="download-btn" (click)="downloadAsFile(csvOutput, 'converted_data.' + (outputFormat === 'tabs' ? 'tsv' : outputFormat), outputFormat === 'json' ? 'application/json' : 'text/plain')">ðŸ’¾ Download</button>
      </div>
    </div>
    
    <textarea 
      id="csvOutput" 
      [(ngModel)]="csvOutput" 
      rows="10" 
      readonly 
      placeholder="Converted data will appear here..."
      class="output-textarea"
    ></textarea>
  </section>

  <!-- CSV Statistics Section - Moved to Bottom -->
  <section class="section" id="csv-analysis" *ngIf="csvStats">
    <h3>CSV Statistics</h3>
    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-label">Rows</span>
        <span class="stat-value">{{ csvStats.rows }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Columns</span>
        <span class="stat-value">{{ csvStats.columns }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Has Headers</span>
        <span class="stat-value">{{ csvStats.hasHeaders ? 'Yes' : 'No' }}</span>
      </div>
    </div>
    
    <div class="headers-section" *ngIf="csvStats.headers.length > 0">
      <h4>Column Information</h4>
      <div class="headers-list">
        <div class="header-item" *ngFor="let header of csvStats.headers; let i = index">
          <span class="header-name">{{ header }}</span>
          <span class="header-type">{{ csvStats.dataTypes[i] }}</span>
        </div>
      </div>
    </div>
  </section>
</div>
